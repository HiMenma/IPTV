# 自动构建使用说明

## 🎯 一分钟快速上手

### 发布新版本（三步走）

```bash
# 1. 创建标签
git tag v1.0.0

# 2. 推送标签
git push origin v1.0.0

# 3. 等待构建完成（15-20分钟）
# 访问 GitHub Releases 页面下载安装包
```

就这么简单！GitHub Actions 会自动：
- ✅ 构建 Windows、macOS、Linux、Android 版本
- ✅ 创建 GitHub Release
- ✅ 上传所有安装包

## 📦 构建产物

| 平台 | 文件格式 | 用途 |
|------|---------|------|
| Windows | `.msi` | Windows 安装程序 |
| macOS | `.dmg` | macOS 磁盘映像 |
| Linux | `.deb` | Debian/Ubuntu 安装包 |
| Android | `.apk` | Android 安装包 |

## 🔧 首次使用配置

### 1. 启用 GitHub Actions

仓库 **Settings** → **Actions** → **General**：
- ✅ Allow all actions
- ✅ Read and write permissions

### 2. 更新 README 徽章

将 `YOUR_USERNAME` 替换为你的 GitHub 用户名

### 3. 测试构建

手动触发一次测试：
1. 进入 **Actions** 页面
2. 选择 "构建发布包"
3. 点击 **Run workflow**
4. 输入版本号 `0.0.1`
5. 等待构建完成

## 📝 版本号管理

### 更新版本号

编辑 `composeApp/build.gradle.kts`：

```kotlin
// 桌面版本
packageVersion = "1.0.0"  // 👈 改这里

// Android 版本
versionCode = 1      // 👈 每次递增
versionName = "1.0"  // 👈 改这里
```

### 版本号规范

- `v1.0.0` - 首次发布
- `v1.1.0` - 新功能
- `v1.1.1` - Bug 修复

## 🚀 发布流程

### 完整流程

```bash
# 1. 更新版本号（编辑 build.gradle.kts）

# 2. 提交更改
git add .
git commit -m "chore: release v1.0.0"

# 3. 创建并推送标签
git tag v1.0.0
git push origin main
git push origin v1.0.0

# 4. 等待构建（GitHub Actions 页面查看进度）

# 5. 检查 Release（GitHub Releases 页面）
```

### 仅测试构建（不发布）

使用 GitHub Actions 页面的 **Run workflow** 按钮手动触发。

## ⚠️ 注意事项

1. **标签格式**：必须以 `v` 开头，如 `v1.0.0`
2. **版本一致**：标签、packageVersion、versionName 保持一致
3. **versionCode**：Android 版本号必须递增
4. **测试后发布**：推送标签前确保代码已测试

## 🔄 回滚发布

```bash
# 删除本地标签
git tag -d v1.0.0

# 删除远程标签
git push origin :refs/tags/v1.0.0

# 在 GitHub 上手动删除 Release
```

## 📚 详细文档

- **[RELEASE_GUIDE.md](RELEASE_GUIDE.md)** - 快速发布指南
- **[GITHUB_ACTIONS_GUIDE.md](GITHUB_ACTIONS_GUIDE.md)** - 完整使用文档
- **[.github/SETUP_CHECKLIST.md](.github/SETUP_CHECKLIST.md)** - 配置检查清单
- **[BUILD_PACKAGES.md](BUILD_PACKAGES.md)** - 本地构建指南

## 💡 常见问题

### Q: 构建失败怎么办？
A: 查看 Actions 日志，确保本地能成功构建

### Q: macOS 应用无法打开？
A: 需要配置代码签名和公证（见详细文档）

### Q: Android APK 无法安装？
A: Debug 版本需要启用"允许未知来源"，Release 版本需要签名

### Q: 如何只构建特定平台？
A: 修改 `.github/workflows/build-release.yml` 的 matrix 配置

## 🎉 开始使用

配置完成后，每次发布只需要三个命令：

```bash
git tag v1.0.0
git push origin v1.0.0
# 等待构建完成
```

就是这么简单！🚀
