# 如何重新打包

## 问题已修复 ✅

两个问题都已经在 `composeApp/build.gradle.kts` 中修复：

1. ✅ **DriverManager 错误** - 添加了 `java.sql` 模块
2. ✅ **图标显示问题** - 修正了图标文件路径

## 方法一：使用脚本（推荐）

### macOS / Linux

```bash
# 给脚本添加执行权限（首次使用）
chmod +x repackage.sh

# macOS 打包
./repackage.sh dmg

# Linux 打包
./repackage.sh deb
```

### Windows

```cmd
# MSI 安装包
repackage.bat msi

# EXE 安装包
repackage.bat exe
```

## 方法二：手动执行命令

### macOS

```bash
./gradlew clean
./gradlew packageDmg
```

打包文件位置：`composeApp/build/compose/binaries/main/dmg/`

### Windows

```cmd
gradlew.bat clean
gradlew.bat packageMsi
```

打包文件位置：`composeApp\build\compose\binaries\main\msi\`

或者打包为 EXE：

```cmd
gradlew.bat clean
gradlew.bat packageExe
```

打包文件位置：`composeApp\build\compose\binaries\main\exe\`

### Linux

```bash
./gradlew clean
./gradlew packageDeb
```

打包文件位置：`composeApp/build/compose/binaries/main/deb/`

## 验证修复

安装新打包的应用后，请验证：

### 1. 图标检查
- [ ] 应用图标正确显示
- [ ] 任务栏/Dock 图标正确显示

### 2. 启动检查
- [ ] 应用正常启动
- [ ] 没有出现 DriverManager 错误
- [ ] 没有其他错误提示

### 3. 功能检查
- [ ] 可以添加播放列表
- [ ] 数据正常保存
- [ ] 数据库文件创建成功（`~/.iptv/iptv.db`）
- [ ] 播放功能正常

## 如果还有问题

### DriverManager 错误仍然存在

1. 完全清理后重新构建：
   ```bash
   ./gradlew clean
   rm -rf build/
   rm -rf composeApp/build/
   ./gradlew packageDmg  # 或其他打包命令
   ```

2. 检查打包日志，确认包含了 java.sql 模块

3. 查看详细文档：`DESKTOP_PACKAGING_FIX.md`

### 图标仍然不显示

1. 确认图标文件存在：
   ```bash
   ls -la composeApp/src/desktopMain/resources/
   ```

2. 检查图标文件格式和尺寸

3. 对于 Windows，可以考虑转换为 .ico 格式

## 相关文档

- `修复总结.md` - 修复内容总结
- `桌面打包修复说明.md` - 详细的中文说明
- `DESKTOP_PACKAGING_FIX.md` - 英文技术文档
- `QUICK_REPACKAGE_GUIDE.md` - 快速操作指南

## 打包时间估计

- macOS DMG: 约 3-5 分钟
- Windows MSI/EXE: 约 3-5 分钟
- Linux DEB: 约 2-4 分钟

实际时间取决于你的机器性能。

## 需要帮助？

如果遇到任何问题，请查看：
1. 打包日志输出
2. `DESKTOP_PACKAGING_FIX.md` 中的故障排除部分
3. 确认所有依赖都已正确安装
