# Android功能测试指南

## 快速测试步骤

### 1. 测试M3U文件导入

#### 准备
1. 在手机上准备一个M3U文件，或从网上下载
2. 确保文件内容格式正确

#### 测试步骤
```
1. 打开应用
2. 点击右下角"+"按钮
3. 选择"本地文件"标签
4. 输入名称（可选）
5. 点击"选择M3U文件"
6. 从文件选择器中选择M3U文件
7. 等待导入完成
```

#### 预期结果
- ✅ 文件选择器正常打开
- ✅ 选择文件后开始导入
- ✅ 显示"正在读取M3U文件..."
- ✅ 导入成功，返回播放列表界面
- ✅ 新播放列表出现在列表中
- ✅ 频道数量正确

#### 如果失败
- 检查是否授予了存储权限
- 检查M3U文件格式是否正确
- 查看logcat日志：`adb logcat | grep FileManager`

---

### 2. 测试M3U文件导出

#### 测试步骤
```
1. 打开应用
2. 找到任意播放列表
3. 点击播放列表右侧的⚙️按钮
4. 选择"导出为M3U"
5. 在文件保存对话框中选择位置
6. 输入文件名
7. 点击保存
```

#### 预期结果
- ✅ 文件保存对话框正常打开
- ✅ 默认文件名为"播放列表名.m3u"
- ✅ 显示"正在导出M3U文件..."
- ✅ 导出成功提示
- ✅ 文件保存到指定位置
- ✅ 文件内容正确

#### 验证导出的文件
```bash
# 使用adb查看文件
adb shell cat /sdcard/Download/playlist.m3u

# 或者在手机上用文本编辑器打开
```

#### 如果失败
- 检查是否授予了存储权限
- 尝试选择不同的保存位置
- 查看logcat日志：`adb logcat | grep FileManager`

---

### 3. 测试全屏播放 - 防止休眠

#### 测试步骤
```
1. 打开应用
2. 选择任意频道播放
3. 点击"全屏"按钮
4. 等待5分钟（或设备默认休眠时间）
```

#### 预期结果
- ✅ 屏幕保持常亮
- ✅ 不会自动锁屏
- ✅ 视频持续播放

#### 退出测试
```
1. 点击屏幕显示控制
2. 点击右上角关闭按钮退出全屏
3. 屏幕恢复正常休眠设置
```

---

### 4. 测试全屏播放 - 进度条

#### 测试步骤
```
1. 播放任意频道
2. 进入全屏模式
3. 点击屏幕显示控制
4. 观察底部进度条
```

#### 预期结果
- ✅ 显示播放进度条
- ✅ 显示当前时间（左侧）
- ✅ 显示总时长（右侧）
- ✅ 进度条随播放实时更新

#### 测试拖动
```
1. 拖动进度条到不同位置
2. 观察视频是否跳转
```

#### 预期结果
- ✅ 拖动流畅
- ✅ 视频跳转到对应位置
- ✅ 时间显示更新

---

### 5. 测试全屏播放 - 音量控制

#### 测试步骤
```
1. 播放任意频道
2. 进入全屏模式
3. 在屏幕右侧区域上下滑动
```

#### 预期结果
- ✅ 向上滑动：音量增加
- ✅ 向下滑动：音量减少
- ✅ 显示音量指示器
- ✅ 显示音量百分比
- ✅ 音量图标随音量变化
  - 0%: VolumeOff 🔇
  - 1-50%: VolumeDown 🔉
  - 51-100%: VolumeUp 🔊
- ✅ 指示器1秒后自动隐藏
- ✅ 系统音量同步变化

#### 验证
- 按物理音量键，观察是否同步
- 打开其他应用，音量设置是否保持

---

### 6. 测试全屏播放 - 亮度控制

#### 测试步骤
```
1. 播放任意频道
2. 进入全屏模式
3. 在屏幕左侧区域上下滑动
```

#### 预期结果
- ✅ 向上滑动：亮度增加
- ✅ 向下滑动：亮度减少
- ✅ 显示亮度指示器
- ✅ 显示亮度百分比
- ✅ 亮度图标随亮度变化
  - 0-30%: BrightnessLow 🔅
  - 31-70%: BrightnessMedium 💡
  - 71-100%: BrightnessHigh 🔆
- ✅ 指示器1秒后自动隐藏
- ✅ 屏幕亮度实时变化

#### 注意
- 亮度调节仅影响当前播放窗口
- 退出全屏后恢复系统亮度设置

---

### 7. 测试控制自动隐藏

#### 测试步骤
```
1. 播放任意频道
2. 进入全屏模式
3. 点击屏幕显示控制
4. 不进行任何操作，等待3秒
```

#### 预期结果
- ✅ 控制按钮3秒后自动隐藏
- ✅ 进度条自动隐藏
- ✅ 退出按钮自动隐藏
- ✅ 屏幕显示纯视频画面

#### 重新显示
```
1. 点击屏幕中间区域
```

#### 预期结果
- ✅ 控制立即显示
- ✅ 3秒后再次自动隐藏

---

## 完整测试流程

### 场景1：导入 → 播放 → 全屏
```
1. 导入M3U文件
2. 进入播放列表
3. 选择频道播放
4. 进入全屏模式
5. 测试音量控制
6. 测试亮度控制
7. 测试进度条
8. 退出全屏
```

### 场景2：导出 → 重新导入
```
1. 导出现有播放列表
2. 删除原播放列表
3. 重新导入导出的文件
4. 验证频道数量和信息
```

### 场景3：长时间播放
```
1. 播放频道
2. 进入全屏
3. 等待10分钟
4. 验证屏幕不休眠
5. 测试各项控制仍然正常
```

---

## 调试技巧

### 查看日志
```bash
# 查看所有日志
adb logcat

# 过滤FileManager日志
adb logcat | grep FileManager

# 过滤IPTV应用日志
adb logcat | grep "com.menmapro.iptv"

# 清除日志后重新开始
adb logcat -c && adb logcat
```

### 检查权限
```bash
# 查看应用权限
adb shell dumpsys package com.menmapro.iptv | grep permission

# 手动授予权限（如果需要）
adb shell pm grant com.menmapro.iptv android.permission.READ_EXTERNAL_STORAGE
adb shell pm grant com.menmapro.iptv android.permission.WRITE_EXTERNAL_STORAGE
```

### 检查文件
```bash
# 列出下载目录
adb shell ls -la /sdcard/Download/

# 查看M3U文件内容
adb shell cat /sdcard/Download/playlist.m3u

# 推送测试文件到设备
adb push test.m3u /sdcard/Download/
```

---

## 常见问题

### Q1: 导入文件时提示"未选择文件"
**A**: 
1. 确保已授予存储权限
2. 重启应用后重试
3. 检查文件是否存在
4. 尝试选择其他文件

### Q2: 导出文件时提示"用户取消"
**A**:
1. 确保已授予存储权限
2. 选择有写入权限的目录
3. 不要在选择器中点击取消
4. 重启应用后重试

### Q3: 全屏时屏幕仍然休眠
**A**:
1. 检查是否正确进入全屏模式
2. 查看logcat确认WAKE_LOCK已设置
3. 检查系统省电模式设置
4. 重启应用后重试

### Q4: 音量/亮度控制不响应
**A**:
1. 确保在正确的区域滑动（左侧=亮度，右侧=音量）
2. 滑动距离要足够
3. 检查是否在全屏模式
4. 重启应用后重试

### Q5: 进度条不显示
**A**:
1. 某些直播流可能没有时长信息
2. 点击屏幕确保控制已显示
3. 等待视频加载完成
4. 尝试其他频道

---

## 性能测试

### 内存使用
```bash
# 查看应用内存使用
adb shell dumpsys meminfo com.menmapro.iptv

# 持续监控
watch -n 1 'adb shell dumpsys meminfo com.menmapro.iptv | grep TOTAL'
```

### CPU使用
```bash
# 查看CPU使用
adb shell top | grep com.menmapro.iptv
```

### 电池消耗
```bash
# 查看电池统计
adb shell dumpsys batterystats | grep com.menmapro.iptv
```

---

## 测试报告模板

### 测试信息
- 测试日期：2025-11-26
- 测试人员：
- 设备型号：
- Android版本：
- 应用版本：1.1.0

### 测试结果

| 功能 | 测试项 | 结果 | 备注 |
|------|--------|------|------|
| 文件导入 | 选择文件 | ✓/✗ | |
| 文件导入 | 读取内容 | ✓/✗ | |
| 文件导出 | 保存文件 | ✓/✗ | |
| 文件导出 | 文件内容 | ✓/✗ | |
| 防止休眠 | 屏幕常亮 | ✓/✗ | |
| 进度条 | 显示正确 | ✓/✗ | |
| 进度条 | 拖动流畅 | ✓/✗ | |
| 音量控制 | 手势响应 | ✓/✗ | |
| 音量控制 | 指示器显示 | ✓/✗ | |
| 亮度控制 | 手势响应 | ✓/✗ | |
| 亮度控制 | 指示器显示 | ✓/✗ | |
| 自动隐藏 | 3秒隐藏 | ✓/✗ | |
| 自动隐藏 | 点击显示 | ✓/✗ | |

### 发现的问题
1. 
2. 
3. 

### 性能数据
- 内存使用：
- CPU使用：
- 电池消耗：

### 建议
1. 
2. 
3. 

---

**测试完成日期**: ___________  
**测试状态**: ✅ 通过 / ⚠️ 部分通过 / ✗ 未通过
