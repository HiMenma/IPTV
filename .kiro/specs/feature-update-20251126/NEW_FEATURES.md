# 新功能说明

本次更新添加了以下4个主要功能：

## 1. 全屏播放优化

### Android平台
- **自动横屏**：进入全屏模式时自动切换到横屏方向
- **自动隐藏控制按钮**：全屏模式下，播放器控制按钮会在3秒后自动隐藏
- **点击显示控制**：在全屏模式下点击屏幕可以重新显示控制按钮
- **沉浸式体验**：全屏时隐藏系统状态栏和导航栏

### 使用方法
1. 在播放界面点击"全屏"按钮进入全屏模式
2. 控制按钮会在3秒后自动隐藏
3. 点击屏幕任意位置可重新显示控制按钮
4. 点击"退出全屏"按钮或返回键退出全屏

## 2. 手动刷新Xtream配置

### 功能说明
- 支持刷新Xtream播放列表，重新从服务器获取最新的频道和分类信息
- Xtream账户信息现在会安全地存储在数据库中
- 刷新时会保留播放列表名称，但更新所有频道数据

### 使用方法
1. 在播放列表界面，找到要刷新的Xtream播放列表
2. 点击播放列表右侧的"更多选项"按钮（齿轮图标）
3. 在弹出菜单中选择"刷新"
4. 等待刷新完成

### 注意事项
- 刷新需要网络连接
- 刷新过程中会重新验证账户信息
- 本地M3U文件播放列表无法刷新

## 3. 导出Xtream为M3U文件

### 功能说明
- 支持将任何播放列表（包括Xtream）导出为标准M3U格式文件
- 导出的M3U文件包含所有频道信息：
  - 频道名称
  - 播放URL
  - 频道Logo
  - 分组信息
  - TVG ID

### 使用方法
1. 在播放列表界面，找到要导出的播放列表
2. 点击播放列表右侧的"更多选项"按钮（齿轮图标）
3. 在弹出菜单中选择"导出为M3U"
4. 选择保存位置和文件名
5. 点击保存

### 应用场景
- 备份播放列表
- 在其他播放器中使用
- 分享给其他用户
- 离线保存频道列表

## 4. 从本地读取M3U源文件

### 功能说明
- 支持从设备存储中选择并导入M3U文件
- 支持标准M3U和M3U8格式
- 自动解析频道信息和分组

### 使用方法
1. 在播放列表界面，点击右下角的"+"按钮
2. 在弹出的对话框中选择"本地文件"标签
3. 输入播放列表名称（可选）
4. 点击"选择M3U文件"按钮
5. 从文件选择器中选择M3U文件
6. 等待导入完成

### 支持的文件格式
- `.m3u` - 标准M3U格式
- `.m3u8` - UTF-8编码的M3U格式

### 注意事项
- 文件必须是有效的M3U格式
- 大文件可能需要较长的导入时间
- 导入后的播放列表类型为"M3U (文件)"

## 技术实现

### 数据库变更
- 添加了Xtream账户信息字段到Playlist表：
  - `xtreamServerUrl`: 服务器地址
  - `xtreamUsername`: 用户名
  - `xtreamPassword`: 密码
- 数据库版本升级到v3，包含自动迁移

### 平台特定实现
- **Android**: 使用Activity Result API实现文件选择和保存
- **Desktop**: 使用Swing JFileChooser实现文件选择和保存

### 新增组件
- `FileManager`: 跨平台文件管理接口
- `PlaylistRepository.exportPlaylistToM3u()`: M3U导出功能
- `PlaylistRepository.refreshPlaylist()`: 播放列表刷新功能

## 升级说明

### 数据库迁移
应用会在启动时自动执行数据库迁移，无需手动操作。迁移过程包括：
1. 检测当前数据库版本
2. 添加新的Xtream账户字段
3. 保留所有现有数据

### 兼容性
- 现有的播放列表不受影响
- 旧版本添加的Xtream播放列表在升级后可以刷新（如果重新添加）
- 所有现有功能保持不变

## 已知限制

1. **全屏自动横屏**：仅在Android平台实现，Desktop平台保持原有行为
2. **Xtream刷新**：需要原始账户信息，旧版本添加的Xtream播放列表需要重新添加才能刷新
3. **文件选择器**：Android需要存储权限，Desktop需要Java Swing支持

## 未来改进

- [ ] 支持批量导出多个播放列表
- [ ] 添加导出进度显示
- [ ] 支持更多文件格式（如XSPF）
- [ ] 添加自动刷新定时任务
- [ ] 支持云端备份和同步
